# This code is compatible with Terraform 4.25.0 and versions that are backward compatible to 4.25.0.
# For information about validating this Terraform code, see https://developer.hashicorp.com/terraform/tutorials/gcp-get-started/google-cloud-platform-build#format-and-validate-the-configuration

resource "google_compute_instance" "instance-20240708-115833" {
  boot_disk {
    auto_delete = true
    device_name = "instance-20240708-115833"

    initialize_params {
      image = "projects/cos-cloud/global/images/cos-stable-113-18244-85-49"
      size  = 10
      type  = "pd-standard"
    }

    mode = "READ_WRITE"
  }

  can_ip_forward      = false
  deletion_protection = false
  enable_display      = false

  labels = {
    container-vm = "cos-stable-113-18244-85-49"
    goog-ec-src  = "vm_add-tf"
  }

  machine_type = "e2-micro"

  metadata = {
    gce-container-declaration = "spec:\n  containers:\n  - name: instance-20240708-115833\n    image: europe-west8-docker.pkg.dev/digitallands-project/docker/discord-ai:a5968e4ea6c4b2bba831ca5c09bdb354e5002b7d\n    env:\n    - name: CLIENT_ID\n      value: '1250722905734778904'\n    - name: CLIENT_SECRET\n      value: s8Ga5BH1jz4vGqNKluny_dgofukG773o\n    - name: DEEPGRAM_API_KEY\n      value: b3e84a4a52bf9a59b9be90b1fe40af900adaef52\n    - name: ELVENLABS_API_KEY\n      value: sk_e2438353e4b9a4b8c11242f4649e4c716101e0682b65cfa1\n    - name: NEO4J_DATABASE_PASSWORD\n      value: uwFngqF26DH9eDkN7JPJy0HxuSWoh5dVWkCSY4igUdY\n    - name: NEO4J_DATABASE_URL\n      value: neo4j+s://8081da8a.databases.neo4j.io:7687\n    - name: NEO4J_DATABASE_USER\n      value: neo4j\n    - name: OPENAI_API_KEY\n      value: sk-proj-AsgPdFnfbcgSNTBdZivIT3BlbkFJPVWizOOQqwPygX2ctH78\n    - name: TOKEN\n      value: MTI1MzI4NjI0MzY4NTYzMDAyNA.G6aw13.X4Vg9L9BfRWkNJcVgSbcLnqe_GbKoydkhJ9krw\n    stdin: false\n    tty: false\n  restartPolicy: Always\n# This container declaration format is not public API and may change without notice. Please\n# use gcloud command-line tool or Google Cloud Console to run Containers on Google Compute Engine."
    gce-container-declaration = <<EOT
    spec:
    containers:
      - name: instance-20240708-115833
      image: europe-west8-docker.pkg.dev/digitallands-project/docker/discord-ai:a5968e4ea6c4b2bba831ca5c09bdb354e5002b7d
      env:
        - name: CLIENT_ID
        value: '1250722905734778904'
        - name: CLIENT_SECRET
        value: s8Ga5BH1jz4vGqNKluny_dgofukG773o
        - name: DEEPGRAM_API_KEY
        value: b3e84a4a52bf9a59b9be90b1fe40af900adaef52
        - name: ELVENLABS_API_KEY
        value: sk_e2438353e4b9a4b8c11242f4649e4c716101e0682b65cfa1
        - name: NEO4J_DATABASE_PASSWORD
        value: uwFngqF26DH9eDkN7JPJy0HxuSWoh5dVWkCSY4igUdY
        - name: NEO4J_DATABASE_URL
        value: neo4j+s://8081da8a.databases.neo4j.io:7687
        - name: NEO4J_DATABASE_USER
        value: neo4j
        - name: OPENAI_API_KEY
        value: sk-proj-AsgPdFnfbcgSNTBdZivIT3BlbkFJPVWizOOQqwPygX2ctH78
        - name: TOKEN
        value: MTI1MzI4NjI0MzY4NTYzMDAyNA.G6aw13.X4Vg9L9BfRWkNJcVgSbcLnqe_GbKoydkhJ9krw
        stdin: false
        tty: false
        restartPolicy: Always
        EOT
  }

  name = "instance-20240708-115833"

  network_interface {
    access_config {
      network_tier = "PREMIUM"
    }

    queue_count = 0
    stack_type  = "IPV4_ONLY"
    subnetwork  = "projects/digitallands-project/regions/us-central1/subnetworks/default"
  }

  scheduling {
    automatic_restart   = true
    on_host_maintenance = "MIGRATE"
    preemptible         = false
    provisioning_model  = "STANDARD"
  }

  service_account {
    email  = "981651558497-compute@developer.gserviceaccount.com"
    scopes = ["https://www.googleapis.com/auth/devstorage.read_only", "https://www.googleapis.com/auth/logging.write", "https://www.googleapis.com/auth/monitoring.write", "https://www.googleapis.com/auth/service.management.readonly", "https://www.googleapis.com/auth/servicecontrol", "https://www.googleapis.com/auth/trace.append"]
  }

  shielded_instance_config {
    enable_integrity_monitoring = true
    enable_secure_boot          = false
    enable_vtpm                 = true
  }

  tags = ["http-server", "https-server", "lb-health-check"]
  zone = europe-west8-a"
}
